{
  "case_id": "logic_bug_08",
  "category": "logic_bug",
  "difficulty": "medium",
  "expected_detection": true,
  "bug_description": "update_stock メソッド内で stock 変数を参照しているが、これは validate_stock! 内のローカル変数であり、スコープが異なるため NameError が発生する。",
  "bug_location": "impl.rb:26",
  "correct_implementation": "def update_stock\n  new_stock = @product.stock - @quantity\n  @product.update!(stock: new_stock)\n  new_stock\nend",
  "tags": ["variable_scope", "shadowing", "undefined_variable"],
  "notes": "変数のスコープに関するバグ。別メソッドで定義したローカル変数を参照しようとしている。@product.stock を直接使用すべき。"
}
