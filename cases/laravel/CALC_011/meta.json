{
  "case_id": "CALC_011",
  "category": "calculation",
  "axis": "spec_alignment",
  "name": "calculation_order_mismatch",
  "difficulty": "medium",
  "expected_detection": true,
  "bug_description": "Calculation order differs from specification; customer type adjustment applied before tax causes premium customers to pay more tax; promotional discount missing entirely",
  "bug_anchor": "calculateCustomerAdjustment($discountedSubtotal",
  "correct_implementation": "Apply discounts in order: quantity discount -> customer discount -> tax -> promotional discount",
  "severity": "critical",
  "tags": [
    "calculation",
    "spec_violation",
    "pricing",
    "tax"
  ],
  "framework": "laravel",
  "framework_version": "11+",
  "php_version": "8.2+",
  "bug_anchor_verified": true,
  "evaluation_mode": "dual",
  "has_expected_critique": false,
  "fix_required": true,
  "must_find": [
    {
      "id": "calculation_order",
      "category": "calculation",
      "keywords": ["order", "tax", "customer", "adjustment", "before"],
      "severity_expected": "major",
      "required": true
    },
    {
      "id": "missing_promo_discount",
      "category": "calculation",
      "keywords": ["promotional", "discount", "missing"],
      "severity_expected": "major",
      "required": false
    }
  ]
}
